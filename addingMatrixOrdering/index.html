<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://sparcityeu.github.io/sparseviz/addingMatrixOrdering/" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Adding Matrix Ordering - SparseViz</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Adding Matrix Ordering";
        var mkdocs_page_input_path = "addingMatrixOrdering.md";
        var mkdocs_page_url = "/sparseviz/addingMatrixOrdering/";
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> SparseViz
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../configUse/">Config File</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">EXTENDING LIBRARY BEYOND</span></p>
              <ul class="current">
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Adding Matrix Ordering</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#step-1-creating-a-custom-ordering-class">Step 1: Creating a Custom Ordering Class</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-2-adding-files-into-cmakeliststxt">Step 2: Adding Files into CMakeLists.txt</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#step-3-adding-ordering-definition-into-sparsevizengine">Step 3: Adding Ordering Definition Into SparseVizEngine</a>
    </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../addingTensorOrdering/">Adding Tensor Ordering</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../addingCPUMatrixKernel/">Adding CPU Matrix Kernel</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../addingGPUMatrixKernel/">Adding GPU Matrix Kernel</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../addingCPUTensorKernel/">Adding CPU Tensor Kernel</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../addingGPUTensorKernel/">Adding GPU Tensor Kernel</a>
                  </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../licence/">Licence</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">SparseViz</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">EXTENDING LIBRARY BEYOND</li>
      <li class="breadcrumb-item active">Adding Matrix Ordering</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="tutorial-2-how-to-add-matrix-ordering">Tutorial 2: How to Add Matrix Ordering</h1>
<p>SparseViz allows its users to add the custom matrix orderings that they
want to implement on their matrices. Adding such matrix orderings into
SparseViz involves a couple of elementary steps. In this tutorial, these
steps are going to be explained in a detailed manner.</p>
<p>Every custom matrix ordering in the SparseViz ecosystem derives from the
abstract MatrixOrdering class. SparseViz/include/Matrix/Orderings is
where the header file of this custom ordering class could be created and
SparseViz/src/Matrix/Orderings is where the source file of this custom
ordering class could be created. In this tutorial, we are going to
create an example matrix ordering named AddingMatrixOrdering and show
how it can be integrated into the library.</p>
<h2 id="step-1-creating-a-custom-ordering-class">Step 1: Creating a Custom Ordering Class</h2>
<p>First, we will create the AddingMatrixOrdering.h file in the
SparseViz/include/Matrix/Orderings directory.</p>
<p>The header file will contain the declaration of our class, which
consists of only 5 lines of C++ code.</p>
<p><em>AddingMatrixOrdering.h</em></p>
<pre><code class="language-cpp">#include &quot;MatrixOrdering&quot;

class AddingMatrixOrdering: public MatrixOrdering

{

public:

    AddingMatrixOrdering(SparseMatrix&amp; matrix, std::string orderingName, std::string orderingParameters);

    virtual void orderingFunction() override;

};
</code></pre>
<p>MatrixOrdering has only one pure virtual function that it dictates to be
overridden by every derived class. This function is called
orderingFunction which would carry the implementation of the ordering
logic. In addition to that, a constructor should be written for the
custom matrix ordering classes whose first 2 parameters have to be the
reference to the matrix on which the ordering will be applied and the
name of the ordering, respectively. The third parameter is optional in
that it can be skipped safely if the custom order does not need any
parameters to work properly.</p>
<p>Having declared our class, next is to create its source file named
AddingMatrixOrdering.cpp under the directory
SparseViz/src/Matrix/Orderings.</p>
<p><em>AddingMatrixOrdering.cpp</em></p>
<pre><code class="language-cpp">#include &quot;AddingMatrixOrdering.h&quot;

AddingMatrixOrdering::AddingMatrixOrdering(SparseMatrix &amp;matrix, std::string orderingName, std::string orderingParameters)
:   MatrixOrdering(matrix, orderingName, true, true, 5)
{

    // Ordering parameters could be parsed (remember the delimiter is '/')

    // and appropriate private member variables could be set here

}

void AddingMatrixOrdering::orderingFunction()
{

    rowIPermutation = new vType[this-&gt;getMatrix().getRowCount()];

    colIPermutation = new vType[this-&gt;getMatrix().getColCount()];

    // Your ordering function logic goes here

}
</code></pre>
<p>There are a couple of important parts in the source code that require
careful attention. The first is the initialization of the base class
MatrixOrdering in the constructor of the AddingMatrixOrdering class.
MatrixOrdering expects the following parameters to be provided.</p>
<p>SparseMatrix&amp; matrix</p>
<p>std::string orderingName</p>
<p>bool rectangularSupport</p>
<p>bool patternUnsymmetricSupport</p>
<p>unsigned int orderingFunctionPrice = 0</p>
<p>The first 2 parameters, matrix, and orderingName, could easily be
provided to the parent class with the constructor parameters of the
child class. The third parameter, rectangularSupport, determines whether
or not this custom ordering class has support for rectangular matrices.
In case a rectangular matrix will be tried to be ordered in a scenario
in which this support is not found, then MatrixOrdering will create an
ordering-supported matrix during the runtime to make this ordering
possible. Similar to the rectangular support parameter, the
patternUnsymmetricSupport parameter determines whether or not this
custom ordering class has support for matrices in which pattern symmetry
is not available. In case a pattern unsymmetric matrix will be tried to
be ordered in a scenario in which this support is not found, an ordering
support matrix will be created in the runtime by the MatrixOrdering
library to make this ordering possible. The last parameter is an integer
between 0 to 10 representing the overhead of the ordering function.
Although it has a default value of 0, we recommend custom ordering
derived classes to specify this value, as appropriate values could
increase the performance of the program. For our ordering class, we will
assume that it supports rectangular and pattern unsymmetric matrices
with an orderingFunction overhead value of 5.</p>
<p>The last important remark that we need to make is that in the custom
matrix orderings, 2 arrays should be generated by orderingFunction.
These are the only protected member variables of the MatrixOrdering base
class whose initialization values are nullptr. These arrays are called
rowIPermutation and colIPermutation which determine the new location of
each row and column after the ordering is implemented. They should be
allocated on the heap with sizes equal to the row size for
rowIPermutation and equal to the col size of colIPermutation. Custom
ordering classes are not responsible for deleting these arrays, as the
MatrixOrdering base class will safely handle this problem.</p>
<h2 id="step-2-adding-files-into-cmakeliststxt">Step 2: Adding Files into CMakeLists.txt</h2>
<p>In the former step, we have created our header file and source file for
our class named AddingMatrixOrdering. In this step, we are going to
include these files in our build automation tool. SparseViz utilizes
CMake as its build system. In the CMakeLists.txt file located under the
project directory, we should include our header file under the
HEADER_FILES environment variable and include our source under the
SOURCE_FILES environment variable, like so:</p>
<p><em>CMakeLists.txt</em></p>
<pre><code class="language-cpp">set(HEADER_FILES

    --- OTHER HEADER FILES (CROPPED) ---

    include/Matrix/Orderings/AddingMatrixOrdering.h

)

set(SOURCE_FILES

    --- OTHER SOURCE FILES (CROPPED) ---

    src/Matrix/Orderings/AddingMatrixOrdering.cpp

)
</code></pre>
<h2 id="step-3-adding-ordering-definition-into-sparsevizengine">Step 3: Adding Ordering Definition Into SparseVizEngine</h2>
<p>As the last step, we are going to add our ordering class definition into
SparseVizEngine and allow the library to identify the presence of this
ordering. As our first job, we are going to include our custom ordering
class' header file into the SparseVizEngine.h:</p>
<p><em>SparseVizEngine.h</em></p>
<pre><code class="language-cpp">#include &quot;AddingMatrixOrdering.h&quot;
</code></pre>
<p>After that, we are going to add the definition of the class to the
matrix ordering factory function located in the source file of the
SparseVizEngine</p>
<p><em>SparseVizEngine.cpp</em></p>
<pre><code class="language-cpp">MatrixOrdering *SparseVizEngine::matrixOrderingFactory(SparseMatrix&amp; matrix, std::string orderingClassName, std::string orderingName, std::string orderingParameters)

{

    --- OTHER ORDERING CLASSES (CROPPED) ---

    else if (orderingClassName == &quot;AddingMatrixOrdering&quot;)

    {

        return new AddingMatrixOrdering(matrix, orderingName, orderingParameters);

    }

    return nullptr;

}
</code></pre>
<p>Having done this, we can easily run this ordering from within the config
file by indicating it under the section *MATRIX_ORDERINGS*, like so:</p>
<p><em>config</em></p>
<pre><code class="language-cpp">*MATRIX_ORDERINGS*

AddingMatrixOrdering | WeHaveAddedAMatrixOrdering | Param1/Param2/Param3
</code></pre>
<p>This concludes the tutorial 2, the way to add matrix orderings into the
library.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../configUse/" class="btn btn-neutral float-left" title="Config File"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../addingTensorOrdering/" class="btn btn-neutral float-right" title="Adding Tensor Ordering">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../configUse/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../addingTensorOrdering/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
